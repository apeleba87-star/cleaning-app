# μ£Όλ―Όλ“±λ΅λ²νΈ μ €μ¥ κΈ°λ¥ μ„¤μ • κ°€μ΄λ“

## π“‹ λ‹¤μ λ‹¨κ³„

### 1λ‹¨κ³„: μ•”νΈν™” ν‚¤ μƒμ„± λ° μ„¤μ •

#### λ°©λ²• 1: μ¤ν¬λ¦½νΈ μ‚¬μ© (κ¶μ¥)
```bash
node generate-encryption-key.js
```

μƒμ„±λ ν‚¤λ¥Ό λ³µμ‚¬ν•μ—¬ `.env.local` νμΌμ— μ¶”κ°€ν•μ„Έμ”:
```env
ENCRYPTION_KEY=μƒμ„±λ-64μ-ν‚¤-μ—¬κΈ°μ—-λ¶™μ—¬λ„£κΈ°
```

#### λ°©λ²• 2: μλ™ μƒμ„±
ν„°λ―Έλ„μ—μ„ λ‹¤μ λ…λ Ήμ–΄ μ‹¤ν–‰:
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### 2λ‹¨κ³„: λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ… ν™•μΈ

`user_sensitive` ν…μ΄λΈ”μ΄ μƒμ„±λμ—λ”μ§€ ν™•μΈν•μ„Έμ”.

Supabase λ€μ‹λ³΄λ“μ—μ„:
1. SQL Editorλ΅ μ΄λ™
2. λ‹¤μ μΏΌλ¦¬ μ‹¤ν–‰ν•μ—¬ ν…μ΄λΈ” ν™•μΈ:
```sql
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
  AND table_name = 'user_sensitive';
```

ν…μ΄λΈ”μ΄ μ—†μΌλ©΄ `add-financial-management-schema.sql` νμΌμ λ‹¤μ λ¶€λ¶„μ„ μ‹¤ν–‰:
- `user_sensitive` ν…μ΄λΈ” μƒμ„± (λΌμΈ 113-120)
- μΈλ±μ¤ μƒμ„± (λΌμΈ 122-123)
- RLS μ •μ±… μ„¤μ • (λΌμΈ 125-141)

### 3λ‹¨κ³„: ν™κ²½ λ³€μ ν™•μΈ

`.env.local` νμΌμ— λ‹¤μμ΄ λ¨λ‘ μλ”μ§€ ν™•μΈ:
```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
ENCRYPTION_KEY=your-64-character-hex-key  # β† μƒλ΅ μ¶”κ°€
```

### 4λ‹¨κ³„: μ• ν”λ¦¬μΌ€μ΄μ… μ¬μ‹μ‘

ν™κ²½ λ³€μλ¥Ό λ³€κ²½ν–μΌλ―€λ΅ κ°λ° μ„λ²„λ¥Ό μ¬μ‹μ‘ν•μ„Έμ”:
```bash
# κ°λ° μ„λ²„ μ¤‘μ§€ (Ctrl+C)
# κ·Έ λ‹¤μ λ‹¤μ‹ μ‹μ‘
npm run dev
```

### 5λ‹¨κ³„: κΈ°λ¥ ν…μ¤νΈ

1. **μƒ μ‚¬μ©μ μƒμ„± ν…μ¤νΈ:**
   - μ—…μ²΄κ΄€λ¦¬μ μ•± β†’ μ‚¬μ©μ κ΄€λ¦¬ β†’ μƒ μ‚¬μ©μ μ΄λ€
   - κΈ‰μ—¬ ν•νƒλ¥Ό "μΌλ‹Ή"μΌλ΅ μ„ νƒ
   - μ£Όλ―Όλ“±λ΅λ²νΈ μ…λ ¥ ν•„λ“κ°€ λ‚νƒ€λ‚λ”μ§€ ν™•μΈ
   - μ£Όλ―Όλ“±λ΅λ²νΈ μ…λ ¥ (μ: 9001011234567)
   - ν•μ΄ν”μ΄ μλ™μΌλ΅ μ¶”κ°€λλ”μ§€ ν™•μΈ (900101-1234567)
   - μ €μ¥ ν›„ λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ•”νΈν™”λμ–΄ μ €μ¥λμ—λ”μ§€ ν™•μΈ

2. **κΈ°μ΅΄ μ‚¬μ©μ μμ • ν…μ¤νΈ:**
   - μ‚¬μ©μ λ©λ΅μ—μ„ μ‚¬μ©μ μ„ νƒ β†’ μμ •
   - κΈ‰μ—¬ λ°©μ‹ νƒ­ β†’ κΈ‰μ—¬ ν•νƒλ¥Ό "μΌλ‹Ή"μΌλ΅ λ³€κ²½
   - μ£Όλ―Όλ“±λ΅λ²νΈ μ…λ ¥ ν•„λ“κ°€ λ‚νƒ€λ‚λ”μ§€ ν™•μΈ
   - μ£Όλ―Όλ“±λ΅λ²νΈ μ…λ ¥ λ° μ €μ¥

3. **λ³΄μ• ν™•μΈ:**
   - Supabaseμ—μ„ `user_sensitive` ν…μ΄λΈ” μ΅°ν
   - `resident_registration_number` μ»¬λΌμ΄ μ•”νΈν™”λ λ¬Έμμ—΄μΈμ§€ ν™•μΈ
   - ν‰λ¬ΈμΌλ΅ μ €μ¥λμ§€ μ•μ•λ”μ§€ ν™•μΈ

### 6λ‹¨κ³„: GitHubμ— ν‘Έμ‹

λ¨λ“  κΈ°λ¥μ΄ μ •μƒ μ‘λ™ν•λ©΄ λ³€κ²½μ‚¬ν•­μ„ GitHubμ— ν‘Έμ‹ν•μ„Έμ”:

```bash
git add .
git commit -m "μ£Όλ―Όλ“±λ΅λ²νΈ μ•”νΈν™” μ €μ¥ κΈ°λ¥ μ¶”κ°€"
git push origin main
```

**β οΈ μ¤‘μ”:** `.env.local` νμΌμ€ μ λ€ GitHubμ— ν‘Έμ‹ν•μ§€ λ§μ„Έμ”!
- `.gitignore`μ— `.env.local`μ΄ ν¬ν•¨λμ–΄ μλ”μ§€ ν™•μΈ
- Vercel λ“± λ°°ν¬ ν™κ²½μ—μ„λ” ν™κ²½ λ³€μλ¥Ό λ³„λ„λ΅ μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤

### 7λ‹¨κ³„: Vercel ν™κ²½ λ³€μ μ„¤μ • (λ°°ν¬ μ‹)

Vercel λ€μ‹λ³΄λ“μ—μ„:
1. ν”„λ΅μ νΈ μ„ νƒ β†’ Settings β†’ Environment Variables
2. `ENCRYPTION_KEY` μ¶”κ°€ (μƒμ„±ν• μ•”νΈν™” ν‚¤)
3. μ¬λ°°ν¬

## π” λ¬Έμ  ν•΄κ²°

### μ•”νΈν™” ν‚¤ μ¤λ¥
- **μ¦μƒ**: "μ•”νΈν™” ν‚¤κ°€ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤" κ²½κ³ 
- **ν•΄κ²°**: `.env.local`μ— `ENCRYPTION_KEY`κ°€ μ¬λ°”λ¥΄κ² μ„¤μ •λμ—λ”μ§€ ν™•μΈ
- **ν™•μΈ**: κ°λ° μ„λ²„ μ¬μ‹μ‘

### λ³µνΈν™” μ‹¤ν¨
- **μ¦μƒ**: "λ°μ΄ν„° λ³µνΈν™”μ— μ‹¤ν¨ν–μµλ‹λ‹¤" μ¤λ¥
- **μ›μΈ**: μ•”νΈν™” ν‚¤κ°€ λ³€κ²½λμ—κ±°λ‚ μΌμΉν•μ§€ μ•μ
- **ν•΄κ²°**: μ¬λ°”λ¥Έ μ•”νΈν™” ν‚¤λ΅ μ„¤μ •

### ν…μ΄λΈ” μ—†μ μ¤λ¥
- **μ¦μƒ**: "relation 'user_sensitive' does not exist"
- **ν•΄κ²°**: `add-financial-management-schema.sql`μ `user_sensitive` ν…μ΄λΈ” μƒμ„± λ¶€λ¶„ μ‹¤ν–‰

## β… μ²΄ν¬λ¦¬μ¤νΈ

- [ ] μ•”νΈν™” ν‚¤ μƒμ„± μ™„λ£
- [ ] `.env.local`μ— `ENCRYPTION_KEY` μ¶”κ°€
- [ ] `user_sensitive` ν…μ΄λΈ” μƒμ„± ν™•μΈ
- [ ] κ°λ° μ„λ²„ μ¬μ‹μ‘
- [ ] μƒ μ‚¬μ©μ μƒμ„± ν…μ¤νΈ μ™„λ£
- [ ] κΈ°μ΅΄ μ‚¬μ©μ μμ • ν…μ¤νΈ μ™„λ£
- [ ] μ•”νΈν™” μ €μ¥ ν™•μΈ
- [ ] GitHub ν‘Έμ‹ (`.env.local` μ μ™Έ)

## π“ μ¶”κ°€ μλ£

- `SECURITY_GUIDE.md`: λ³΄μ• κ°€μ΄λ“
- `lib/utils/encryption.ts`: μ•”νΈν™” μ ν‹Έλ¦¬ν‹° μ½”λ“
- `app/api/business/users/[id]/sensitive/route.ts`: API μ—”λ“ν¬μΈνΈ

